<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ í…ŒìŠ¤íŠ¸</title>
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
    /* í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ê°„ë‹¨í•œ ìŠ¤íƒ€ì¼ë§ */
    body { font-family: 'Malgun Gothic', sans-serif; background: #f4f6f9; padding: 20px; }
    .dashboard-container { display: flex; gap: 20px; flex-wrap: wrap; }
    .card { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); flex: 1; min-width: 300px; }
    h3 { margin-top: 0; color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }

    /* ë™ ìƒíƒœ ìŠ¤íƒ€ì¼ */
    .status-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .status-item { background: #f8f9fa; padding: 10px; border-radius: 5px; text-align: center; }
    .status-label { font-size: 12px; color: #666; display: block; }
    .status-value { font-size: 18px; font-weight: bold; color: #333; }

    /* ì„ê³„ê°’ ìƒ‰ìƒ (ì‘ì„±í•˜ì‹  ì½”ë“œì™€ ë§¤ì¹­) */
    .threshold-high { color: #dc3545 !important; font-weight: bold; }
    .threshold-low { color: #ffc107 !important; font-weight: bold; }
    .alarm-active { color: red; animation: blink 1s infinite; }
    .fire-active { color: red; font-size: 24px; }

    /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #f1f1f1; }
    .has-data { cursor: pointer; background-color: #fff; }
    .has-data:hover { background-color: #f0f8ff; }

    /* ì°¨íŠ¸ ì˜ì—­ */
    #chart { width: 100%; height: 350px; }

    /* íŒì˜¤ë²„ */
    #popover { display: none; position: absolute; background: white; border: 1px solid #999; padding: 15px; z-index: 1000; box-shadow: 0 4px 8px rgba(0,0,0,0.2); width: 300px; border-radius: 5px; }

    /* ëª¨ë‹¬ */
    #cellModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 1px solid #ccc; z-index: 2000; box-shadow: 0 0 10px rgba(0,0,0,0.5); width: 400px; }
    #cellModal.active { display: block; }
    .close-btn { float: right; cursor: pointer; font-size: 20px; }

    @keyframes blink { 50% { opacity: 0; } }
  </style>
</head>
<body>

<h1>ğŸ”‹ ESS ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ (í…ŒìŠ¤íŠ¸ ëª¨ë“œ)</h1>

<div class="dashboard-container">
  <div class="card status">
    <h3>Rack Status</h3>
    <div class="status-grid">
      <div class="status-item"><span class="status-label">ìƒíƒœ</span><span class="mbms-status status-value">-</span></div>
      <div class="status-item"><span class="status-label">SOC</span><span class="rack-soc status-value">-</span></div>
      <div class="status-item"><span class="status-label">ì „ì••</span><span class="rack-dc-voltage status-value">-</span></div>
      <div class="status-item"><span class="status-label">ì „ë¥˜</span><span class="rack-current status-value">-</span></div>
      <div class="status-item"><span class="status-label">ì˜¨ë„</span><span class="rack-temperature status-value">-</span></div>
      <div class="status-item">
        <span class="status-label">ì•ŒëŒ/í™”ì¬</span>
        <div>
          <i class="fa-solid fa-triangle-exclamation" style="font-size: 20px; color: #ccc;"></i>
          <i class="fa-solid fa-fire" style="margin-left: 10px; font-size: 20px; color: #ccc;"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="card" style="flex: 2;">
    <h3>Real-time Chart</h3>
    <div id="chart"></div>
  </div>
</div>

<div class="dashboard-container" style="margin-top: 20px;">
  <div class="card event_1" id="eventContent">
    <h3>Event History</h3>
    <table>
      <thead><tr><th>No</th><th>Time</th><th>Description</th></tr></thead>
      <tbody>
      <tr><td colspan="3">-</td></tr>
      <tr><td colspan="3">-</td></tr>
      <tr><td colspan="3">-</td></tr>
      <tr><td colspan="3">-</td></tr>
      <tr><td colspan="3">-</td></tr>
      </tbody>
    </table>
  </div>

  <div class="card">
    <h3>Module Info</h3>
    <table>
      <thead><tr><th>ID</th><th>Status</th><th>Volt</th><th>Max Cell</th><th>Min Cell</th><th>Temp</th><th>Alarm</th></tr></thead>
      <tbody id="moduleTableBody">
      <tr><td colspan="7">-</td></tr>
      <tr><td colspan="7">-</td></tr>
      <tr><td colspan="7">-</td></tr>
      <tr><td colspan="7">-</td></tr>
      <tr><td colspan="7">-</td></tr>
      <tr><td colspan="7">-</td></tr>
      </tbody>
    </table>
  </div>
</div>

<div id="popover">
  <h4>ì´ë²¤íŠ¸ ìƒì„¸ <span style="float:right; cursor:pointer;" onclick="closePopover()">X</span></h4>
  <p><strong>íƒ€ì…:</strong> <span id="eventType"></span></p>
  <p><strong>ì‹œê°„:</strong> <span id="eventDt"></span></p>
  <p><strong>ë‚´ìš©:</strong> <pre id="eventDetail" style="white-space: pre-wrap; background:#eee; padding:5px;"></pre></p>
</div>

<div id="cellModal">
  <span class="close-btn" onclick="closeCellModal()">&times;</span>
  <h3>Cell Detail Data</h3>
  <table>
    <thead><tr><th>Module</th><th>Cell ID</th><th>Voltage</th></tr></thead>
    <tbody id="cellTableBody"></tbody>
  </table>
</div>

<script>
  // ============================================================
  // 3. [MOCK SERVER] ê°€ì§œ ë°ì´í„° ì‘ë‹µ ì„¤ì • (Axios ê°€ë¡œì±„ê¸°)
  // ============================================================
  const MOCK_START_TIME = Date.now();
  let mockCurrentTime = MOCK_START_TIME;

  // Axios ìš”ì²­ì„ ê°€ë¡œì±„ì„œ ê°€ì§œ ë°ì´í„°ë¥¼ ë°˜í™˜
  axios.get = function(url, config) {
    console.log(`[API í˜¸ì¶œ] ${url}`);

    return new Promise((resolve) => {
      // A. ì´ˆê¸° ì°¨íŠ¸ ë°ì´í„° (/api/chart)
      if (url === "/api/chart") {
        const data = [];
        // 1ì‹œê°„ ì „ë¶€í„° í˜„ì¬ê¹Œì§€ 10ì´ˆ ê°„ê²© ë°ì´í„° ìƒì„±
        // â˜… í…ŒìŠ¤íŠ¸ í¬ì¸íŠ¸: ì¤‘ê°„ì— 30ì´ˆ ê³µë°±ì„ ë§Œë“¤ì–´ ì°¨íŠ¸ ëŠê¹€ ë¡œì§ í™•ì¸
        for (let i = 0; i < 360; i++) {
          const time = MOCK_START_TIME - (3600 * 1000) + (i * 10000);

          // 20ë¶„ ì „ì¯¤ì— ë°ì´í„° ëˆ„ë½ ì‹œë®¬ë ˆì´ì…˜
          if (i > 100 && i < 105) continue;

          data.push({
            createdAt: new Date(time).toISOString(),
            rackDcVoltage: 54 + Math.random(),
            rackCurrent: 1.5 + Math.random() * 0.5,
            rackTemperature: 25 + Math.random()
          });
        }
        setTimeout(() => resolve({ data: data }), 500);
      }

      // B. ëŒ€ì‹œë³´ë“œ ê°±ì‹  ë°ì´í„° (/api/updateDashboard)
      else if (url === "/api/updateDashboard") {
        const mockResponse = {
          eventHistory: [
            { id: 1, eventType: "WARNING", eventDt: new Date().toISOString(), eventDesc: "ì „ì•• ë¶ˆì•ˆì • ê°ì§€" },
            { id: 2, eventType: "MODE", eventDt: new Date(Date.now()-50000).toISOString(), eventDesc: "ì¶©ì „ ëª¨ë“œ ì „í™˜" }
          ],
          moduleInfo: Array.from({length: 6}, (_, i) => ({
            moduleId: i+1,
            batteryModuleStatus: "Normal",
            moduleDcVoltage: (40 + Math.random()).toFixed(1),
            maxCellVoltage: 4.12,
            minCellVoltage: 4.01,
            avgModuleTemperature: 26.5,
            hasAlarm: i === 2 // 3ë²ˆì§¸ ëª¨ë“ˆ ì•ŒëŒ í…ŒìŠ¤íŠ¸
          })),
          rackStatusInfo: {
            mbmsStatus: "Running",
            rackSoc: 85,
            rackDcVoltage: (55 + Math.random()).toFixed(1), // ì „ì•• ë³€ë™
            rackTemperature: 27,
            rackCurrent: 1.2,
            hasAlarm: false
          },
          fireStatusInfo: { fireStatus: 0 }
        };
        setTimeout(() => resolve({ data: mockResponse }), 200);
      }

      // C. ì‹¤ì‹œê°„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (/api/chart/latest)
      else if (url === "/api/chart/latest") {
        const data = [];
        const now = Date.now();
        // í˜„ì¬ ì‹œê°„ ê¸°ì¤€ ë°ì´í„° 1ê°œ ìƒì„±
        data.push({
          createdAt: new Date(now).toISOString(),
          rackDcVoltage: 54 + Math.random(),
          rackCurrent: 1.5 + Math.random(),
          rackTemperature: 25.5
        });
        setTimeout(() => resolve({ data: data }), 200);
      }

      // D. ì´ë²¤íŠ¸ ìƒì„¸ (/api/eventDetail)
      else if (url === "/api/eventDetail") {
        resolve({ data: { eventDetail: "ìƒì„¸ ë¡œê·¸: 1ë²ˆ ì…€ ì „ì•• ë¶ˆê· í˜• / ì¡°ì¹˜ ìš”ë§" } });
      }

      // E. ì…€ ìƒì„¸ ëª¨ë‹¬ (/api/cellModal)
      else if (url === "/api/cellModal") {
        const cells = Array.from({length: 10}, (_, i) => ({
          moduleId: config.params.moduleId,
          cellId: i+1,
          voltage: (3.9 + Math.random() * 0.3).toFixed(3)
        }));
        resolve({ data: { cellInfo: cells } });
      }
    });
  };

  // ============================================================
  // 4. [USER CODE] ì‘ì„±í•˜ì‹  ì½”ë“œ (ê·¸ëŒ€ë¡œ ë³µì‚¬)
  // ============================================================

  // ì „ì—­ ë³€ìˆ˜ (ì‘ì„±í•˜ì‹  ì½”ë“œì—ì„œ ì‚¬ìš©)
  let previousEventHistory = null;
  let interval = null; // ëª¨ë‹¬ìš© ì¸í„°ë²Œ ë³€ìˆ˜ ì¶”ê°€

  // ì‘ì„±í•˜ì‹  ì½”ë“œ ì‹œì‘ =========================================

  // DOM ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
  document.addEventListener('DOMContentLoaded', function () {
    const params = new URLSearchParams(location.search);
    const essId = params.get("essId") ? params.get("essId") : 7;
    const rackDeviceId = params.get("rackDeviceId") ? params.get("rackDeviceId") : 1;

    loadChart(essId, rackDeviceId);
    updateDashboard();

    // ì‹¤ì‹œê°„ ì°¨íŠ¸ ê°±ì‹  (í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ 2ì´ˆ ê°„ê²©ìœ¼ë¡œ ì„¤ì •)
    setInterval(() => lastRackStatusPoint(essId, rackDeviceId), 2000);
  })

  // ë°ì´í„° ê°±ì‹ 
  function updateDashboard() {
    const params = new URLSearchParams(location.search).get("essId");
    const essId = params ? params : 7;

    axios.get("/api/updateDashboard", { params: { essId } })
            .then(response => {
              const data = response.data;
              updateEventHistory(data.eventHistory);
              updateModule(data.moduleInfo);
              updateRackStatus(data.rackStatusInfo);
              updateFireStatus(data.fireStatusInfo);

              // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì¬ê·€ í˜¸ì¶œ ë”œë ˆì´ë¥¼ 2ì´ˆë¡œ ëŠ˜ë¦¼
              setTimeout(updateDashboard, 2000);
            })
            .catch(error => {
              console.error('ê°±ì‹  ì‹¤íŒ¨', error);
            })
  }

  // ì´ë²¤íŠ¸ íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
  function updateEventHistory(eventHistory) {
    const tbody = document.querySelector('#eventContent tbody');
    const rows = tbody.querySelectorAll('tr');

    if (!eventHistory || eventHistory.length === 0) {
      rows.forEach(tr => {
        tr.innerHTML = '<td colspan="3">-</td>';
        tr.classList.remove('has-data');
        tr.onclick = null;
      });
      return;
    }

    eventHistory.forEach((events, index) => {
      if (rows[index]) {
        // ê¸°ì¡´ êµ¬ì¡°ì— ë§ê²Œ ì…€ ì„ íƒ ë¡œì§ ì•½ê°„ ìˆ˜ì • (td ìˆœì„œëŒ€ë¡œ)
        const cells = rows[index].querySelectorAll('td');
        // í…ŒìŠ¤íŠ¸ HTML êµ¬ì¡°ìƒ: 0:No, 1:Time, 2:Desc

        if (events) {
          rows[index].classList.add('has-data');
          rows[index].onclick = function() { showDetail(this, events.id); }; // í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
        } else {
          rows[index].classList.remove('has-data');
          rows[index].onclick = null;
        }

        if (cells[0]) cells[0].textContent = index + 1;
        if (cells[1]) cells[1].textContent = events.eventDt ? formatData(events.eventDt) : '-';
        if (cells[2]) cells[2].textContent = events.eventDesc || '-';

        rows[index].dataset.eventId = events.id || '';
        rows[index].dataset.eventType = events.eventType || '';
        rows[index].dataset.eventDt = events.eventDt || '';
      }
    });
    previousEventHistory = eventHistory;
  }

  // ë™ ìƒíƒœ ì—…ë°ì´íŠ¸
  function updateRackStatus (rackStatusInfo) {
    const status = document.querySelector('.mbms-status');
    const soc = document.querySelector('.rack-soc');
    const voltage = document.querySelector('.rack-dc-voltage');
    const temperature = document.querySelector('.rack-temperature');
    const current = document.querySelector('.rack-current');
    const alarmIcon = document.querySelector('.fa-triangle-exclamation');

    if (rackStatusInfo != null) {
      if (status) status.textContent = rackStatusInfo.mbmsStatus || '-';
      if (soc) soc.textContent = rackStatusInfo.rackSoc != null ? rackStatusInfo.rackSoc + '%' : '-';

      if (voltage) {
        voltage.textContent = rackStatusInfo.rackDcVoltage != null ? rackStatusInfo.rackDcVoltage + 'V' : '-';
        voltage.classList.remove('threshold-high', 'threshold-low');
        if (rackStatusInfo.rackDcVoltage > 60) voltage.classList.add('threshold-high');
        else if (rackStatusInfo.rackDcVoltage < 50) voltage.classList.add('threshold-low');
      }
      if (temperature) {
        temperature.textContent = rackStatusInfo.rackTemperature != null ? rackStatusInfo.rackTemperature + 'ËšC' : '-';
        // (ìƒëµ: ìŠ¤íƒ€ì¼ ë¡œì§ ë™ì¼)
      }
      if (current) {
        current.textContent = rackStatusInfo.rackCurrent != null ? rackStatusInfo.rackCurrent + 'A' : '-';
      }
    }

    // ì•ŒëŒ ì•„ì´ì½˜ ì²˜ë¦¬
    if (alarmIcon) {
      if (rackStatusInfo != null && rackStatusInfo.hasAlarm === true) alarmIcon.classList.add('alarm-active');
      else alarmIcon.classList.remove('alarm-active');
    }
  }

  // í™”ì¬ ìƒíƒœ
  function updateFireStatus(fireStatusInfo) {
    const fire = document.querySelector('.fa-fire');
    if (fire) {
      if (fireStatusInfo != null && fireStatusInfo.fireStatus === 1) fire.classList.add('fire-active');
      else fire.classList.remove('fire-active');
    }
  }

  // ëª¨ë“ˆ ì—…ë°ì´íŠ¸
  function updateModule(moduleInfo) {
    const tbody = document.getElementById("moduleTableBody");
    const rows = tbody.querySelectorAll('tr');

    if (!moduleInfo || moduleInfo.length === 0 ) return;

    moduleInfo.forEach((module, index) => {
      if (rows[index]) {
        const cells = rows[index].querySelectorAll('td');
        // HTML êµ¬ì¡°ìƒ: 0:ID, 1:Status, 2:Volt, 3:Max, 4:Min, 5:Temp, 6:Alarm

        rows[index].classList.add('has-data');
        // ë”ë¸”í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²° (ì‘ì„±í•˜ì‹  ì½”ë“œ ë¡œì§)
        rows[index].ondblclick = function() { openCellModal(7, module.moduleId); };

        if (cells[0]) cells[0].textContent = module.moduleId;
        if (cells[1]) cells[1].textContent = module.batteryModuleStatus;
        if (cells[2]) cells[2].textContent = module.moduleDcVoltage;
        if (cells[5]) cells[5].textContent = module.avgModuleTemperature;

        // ì•ŒëŒ ì•„ì´ì½˜
        if (cells[6]) {
          if (module.hasAlarm) cells[6].innerHTML = '<i class="fa-solid fa-triangle-exclamation" style="color:red"></i>';
          else cells[6].textContent = '-';
        }
      }
    });
  }

  // [ì¤‘ìš”] ì‘ì„±í•˜ì‹  loadChart (ì •ë ¬ ë¡œì§ ì¶”ê°€ë¨)
  function loadChart(essId, rackDeviceId) {
    axios.get("/api/chart", { params : { essId, rackDeviceId }})
            .then(response => {
              let voltageData = [], currentData = [], temperatureData = [];

              if (response.data && response.data.length > 0) {
                // â˜… ì•ˆì „ì¥ì¹˜: ì‹œê°„ìˆœ ì •ë ¬
                response.data.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));

                let prevTime = null;
                response.data.forEach(history => {
                  const currentTime = new Date(history.createdAt).getTime();

                  if (prevTime !== null) {
                    const timeDiff = currentTime - prevTime;
                    if (timeDiff > 10000) {
                      const disconnectStartTime = prevTime + 1000;
                      [voltageData, currentData, temperatureData].forEach(arr => arr.push([disconnectStartTime, null]));

                      const disconnectEndTime = currentTime - 1000;
                      [voltageData, currentData, temperatureData].forEach(arr => arr.push([disconnectEndTime, null]));
                    }
                  }
                  voltageData.push([currentTime, history.rackDcVoltage]);
                  currentData.push([currentTime, history.rackCurrent]);
                  temperatureData.push([currentTime, history.rackTemperature]);
                  prevTime = currentTime;
                });
              }

              drawGraph(voltageData, currentData, temperatureData, false);

              const rackChart = Highcharts.charts.find(chart => chart && chart.renderTo.id === 'chart');
              if (rackChart) {
                rackChart.lastCreatedAtMillis = (response.data && response.data.length > 0)
                        ? new Date(response.data[response.data.length - 1].createdAt).getTime() : 0;
              }
            }).catch(error => {
      console.error('ì°¨íŠ¸ ì‹¤íŒ¨', error);
      drawGraph([], [], [], true);
    });
  }

  // [ì¤‘ìš”] ì‘ì„±í•˜ì‹  lastRackStatusPoint
  function lastRackStatusPoint(essId, rackDeviceId) {
    const rackChart = Highcharts.charts.find(chart => chart && chart.renderTo.id === 'chart');
    if (!rackChart || !rackChart.lastCreatedAtMillis) return;

    const lastCreatedAt = formatData(rackChart.lastCreatedAtMillis);

    axios.get("/api/chart/latest", {
      params: { essId, rackDeviceId, lastCreatedAt }
    }).then(response => {
      const lastestRackStatus = response.data;
      if (!lastestRackStatus || lastestRackStatus.length === 0) return;

      const now = Date.now();
      const oneHourAgo = now - (60 * 60 * 1000);
      let updated = false;

      lastestRackStatus.forEach(data => {
        const createdAtMillis = new Date(data.createdAt).getTime();
        if (createdAtMillis <= rackChart.lastCreatedAtMillis) return;

        const timeDiff = createdAtMillis - rackChart.lastCreatedAtMillis;

        if (timeDiff > 10000) {
          console.log('ëŠê¹€ ê°ì§€! Null ì¶”ê°€');
          const disconnectStart = rackChart.lastCreatedAtMillis + 1000;
          [0,1,2].forEach(i => rackChart.series[i].addPoint([disconnectStart, null], false));

          const disconnectEnd = createdAtMillis - 1000;
          [0,1,2].forEach(i => rackChart.series[i].addPoint([disconnectEnd, null], false));
        }

        rackChart.lastCreatedAtMillis = createdAtMillis;
        updated = true;

        // shift ë¡œì§ (100ê°œ ë„˜ìœ¼ë©´ shift)
        const shift = rackChart.series[0].data.length > 100;
        rackChart.series[0].addPoint([createdAtMillis, data.rackDcVoltage], false, shift);
        rackChart.series[1].addPoint([createdAtMillis, data.rackCurrent], false, shift);
        rackChart.series[2].addPoint([createdAtMillis, data.rackTemperature], false, shift);
      });

      if (updated) rackChart.redraw();
    });
  }

  // ê·¸ë˜í”„ ê·¸ë¦¬ê¸° í•¨ìˆ˜ (ì‘ì„±í•˜ì‹  ë‚´ìš©ê³¼ ë™ì¼)
  function drawGraph(voltageData, currentData, temperatureData, isError) {
    const now = Date.now();
    const oneHourAgo = now - (60 * 60 * 1000);

    Highcharts.chart('chart', {
      chart: { type: 'line', zoomType: 'x' },
      title: { text: 'Rack Chart (Test)' },
      xAxis: { type: 'datetime' },
      yAxis: { title: { text: 'Value' } },
      plotOptions: { series: { connectNulls: false } }, // ëŠê¹€ í‘œì‹œ í•µì‹¬
      series: [
        { name: 'ì „ì••', data: voltageData },
        { name: 'ì „ë¥˜', data: currentData },
        { name: 'ì˜¨ë„', data: temperatureData }
      ]
    });
  }

  // ë‚ ì§œ í¬ë§· (ìˆ˜ì •ëœ ë²„ì „)
  function formatData(eventDt) {
    if(!eventDt) return '-';
    const d = new Date(eventDt);
    return d.toISOString().replace('T', ' ').substring(0, 19);
  }

  // íŒì˜¤ë²„/ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ (ê°„ì†Œí™”)
  function showDetail(row, id) {
    document.getElementById('popover').style.display = 'block';
    document.getElementById('popover').style.top = (row.offsetTop + 150) + 'px';
    document.getElementById('popover').style.left = '200px';

    // ìƒì„¸ ë‚´ìš© í˜¸ì¶œ í…ŒìŠ¤íŠ¸
    axios.get("/api/eventDetail").then(res => {
      document.getElementById('eventDetail').textContent = res.data.eventDetail;
    });
  }
  function closePopover() { document.getElementById('popover').style.display = 'none'; }

  function openCellModal(essId, moduleId) {
    document.getElementById('cellModal').classList.add('active');
    // ì…€ ë°ì´í„° í˜¸ì¶œ
    axios.get("/api/cellModal", { params: { moduleId } }).then(res => {
      const tbody = document.getElementById('cellTableBody');
      tbody.innerHTML = '';
      res.data.cellInfo.forEach(cell => {
        tbody.innerHTML += `<tr><td>${cell.moduleId}</td><td>${cell.cellId}</td><td>${cell.voltage}</td></tr>`;
      });
    });
  }
  function closeCellModal() { document.getElementById('cellModal').classList.remove('active'); }

  // ì‘ì„±í•˜ì‹  ì½”ë“œ ë ===========================================

</script>
</body>
</html>